#!/bin/bash
set -euxo pipefail

echo "üßπ Starting Secure AI Infoblox cleanup..."

cd /root/infoblox-lab/secure-ai-infoblox/scripts || {
  echo "‚ùå Could not enter script directory. Exiting."
  exit 1
}

# Optional scripts (still commented out)
# python3 extract_provider_ids.py || echo "‚ö†Ô∏è extract_provider_ids.py failed, skipping"
# sleep 10
# python3 delete_providers.py || echo "‚ö†Ô∏è delete_providers.py failed, skipping"
# sleep 10
# python3 extract_my_dns_view_ids.py || echo "‚ö†Ô∏è extract_my_dns_view_ids.py failed, skipping"
# sleep 10
# python3 delete_dns_views.py || echo "‚ö†Ô∏è delete_dns_views.py failed, skipping"
# sleep 10
# python3 delete_azure_credential_from_file.py || echo "‚ö†Ô∏è delete_azure_credential_from_file.py failed, skipping"
# sleep 10

echo "üîß Running delete_niosxaas.py"
python3 delete_niosxaas.py || echo "‚ö†Ô∏è delete_niosxaas.py failed, continuing..."

sleep 20

echo "üîß Running delete_sandbox.py"
python3 delete_sandbox.py || echo "‚ö†Ô∏è delete_sandbox.py failed, continuing..."

sleep 10

echo "üîß Running clean_dns_web.py"
python3 clean_dns_web.py || echo "‚ö†Ô∏è clean_dns_web.py failed, continuing..."

sleep 10

echo "üîß Running delete_user.py"
if [[ -f user_id.txt ]]; then
  python3 delete_user.py || echo "‚ö†Ô∏è delete_user.py failed, continuing..."
else
  echo "‚ö†Ô∏è Skipping delete_user.py: user_id.txt not found"
fi

sleep 10

echo "‚úÖ Secure AI Infoblox cleanup completed."